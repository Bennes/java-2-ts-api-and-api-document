/*! zengxiao版权所有，翻版必究 */!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./",r(r.s=30)}({0:function(e,t){e.exports=path},1:function(e,t){e.exports=fs},15:function(e,t){e.exports=classTools},3:function(e,t){e.exports=conf},30:function(e,t,r){const{tmppath:n,apiDist:o,rest:u,typeService:i,manualApi:s}=r(3),{join:p,sep:c}=r(0),{formatParam:l,formatResult:a,formatName:f}=r(31),y=r(1),h=p(n,"/api"),d=r(15),m={};const g=Object.keys(u),j={};g.forEach(e=>{j[p(h,c+e.replace(/\./g,c))]={reg:null==u[e]?/[\s\S]*/:new RegExp(`(^${("string"==typeof u[e]?[u[e]]:u[e]).join("$)|(^")}$)`.replace(/\{/g,"\\{").replace(/\}/g,"\\}"),"i"),dist:p(o,c+e.replace(/\./g,c)+".ts")},function(e){if(m[e])return;if(y.existsSync(e))return void(m[e]=!0);const t=e.split(c);let r;for(r=t.length-1;r>0&&!y.existsSync(t.slice(0,r).join(c));r--);for(let e=r+1;e<=t.length;e++)y.mkdirSync(t.slice(0,e).join(c));m[e]=!0}(p(o,e.replace(/\.[^.]+$/,"").replace(/\./g,c)))});const b=y.stat;var x=function(e,t){y.readdir(e,function(r,n){if(r)throw r;n.forEach(function(r){var n,o,u=e+"/"+r,i=t+"/"+r;b(u,function(e,t){if(e)throw e;t.isFile()?(n=y.createReadStream(u),o=y.createWriteStream(i),n.pipe(o)):t.isDirectory()&&v(u,i,x)})})})},v=function(e,t,r){y.exists(t,function(n){n?r(e,t):y.mkdir(t,function(){r(e,t)})})};Object.keys(j).forEach(e=>{const t=d(e);let r=[i.header];t.forEach(t=>{if(!j[e].reg.test(t.url))return;console.info("开始解析:",t.url);const n=f(t.url.replace(/\{|\}/g,"")),o=l(t.params),u=a(t.result),s=t.action.toUpperCase();r.push(i.req({params:o,result:u,actionType:s,urlName:n,url:t.url}))}),y.writeFileSync(j[e].dist,r.join("\n"),t=>{t?console.error("服务生成失败:",j[e].dist):console.log("服务生成成功:",j[e].dist)})}),null!=s&&v(s,o,x)},31:function(e,t){function r(e,t){let n=[];if(e[t]||n.push("?"),n.push(":"),"object"==e.type)null==e.value?n.push("any"):n.push(`{[key:string]:${r(e.value,t).replace(/^\?{0,1}:/,"")}}`);else if("array"==e.type)n.push(`${r(e.value,t).replace(/^\?{0,1}:/,"")}[]`);else if("string"==typeof e.type)n.push(e.type);else{if(null!=e.type.type&&("object"==e.type.type||"array"==e.type.type))return"array"==e.type.type&&"isRequired"!=t&&(n=[":"]),n.join("")+r(e.type,t).replace(/^\?{0,1}:/g,"");n.push("{"),Object.keys(e.type).forEach((o,u)=>{u>0&&n.push(","),n.push(o),n.push(r(e.type[o],t))}),n.push("}")}return n.join("")}e.exports.formatName=function(e){const t=[];return e.split(/\//).forEach((e,r)=>{0!=r&&t.push(function(e){return e.substr(0,1).toUpperCase()+e.substr(1)}(e))}),t.join("")},e.exports.formatParam=function(e){let t=["{"];return Object.keys(e).forEach((n,o)=>{o>0&&t.push(","),t.push(n),t.push(r(e[n],"isRequired"))}),t.push("}"),t.join("")},e.exports.formatResult=function(e){let t=["{result"];return e.returnNotNull=!0,t.push(r(e,"returnNotNull")),t.push("}"),t.join("").replace(/^\{result:|\}$/g,"")}}});