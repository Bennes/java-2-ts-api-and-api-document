/*! zengxiao版权所有，翻版必究 */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=32)}({0:function(e,t){e.exports=path},1:function(e,t){e.exports=fs},15:function(e,t){e.exports=classTools},3:function(e,t){e.exports=conf},32:function(e,t,n){const{apiDoc:r,apiRest:o,tmppath:i}=n(3),s=n(33),l=n(1),{join:a}=n(0),u=n(15);l.existsSync(a(r,"./api"))||l.mkdirSync(a(r,"./api"));const c=l.readFileSync(a(r,"./index.js"),{encoding:"utf-8"}),p=JSON.parse(c.replace(/(^\s*const\s+data\s*=\s*)|(\;\s*$)/g,""));Array.prototype.last=function(){return 0==this.length?null:this[this.length-1]},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};const f=l.readFileSync(a(r,"./template.html"),{encoding:"utf-8"});function d(e){for(var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r=0;r<n.length;r++){if(n.length<r)return!0;const e=t.charCodeAt(r),o=n.charCodeAt(r);if(e!=o)return e-o>0}return!0}function y(e,t){if("object"==e){if(null==e.value)return{type:"object"};const n=y(e.value,t);return"string"==typeof n?`{[key:string]:${n}}`:{type:"object",detail:n}}if("array"==e){const n=y(e.value,t);return"string"==typeof n?n+"[]":{type:"object[]",detail:n}}if("string"==typeof e)return e;if(null==e.type||"object"!=e.type&&"array"!=e.type){const n=[];let r;return Object.keys(e).forEach(o=>{r=y(e[o].type,t),n.push({name:o,[t?"isRequired":"isReturnNotNull"]:t?e[o].isRequired:e[o].returnNotNull,note:null==e[o].note?"":e[o].note.replace(/(^\/)|(\/$)|(\<br\>)|([\r\n\*])|(\s*)/g,"").trim(),..."string"==typeof r?{type:r}:r})}),n.sort((e,t)=>{const n=e.isRequired||e.isReturnNotNull;return n==(t.isRequired||t.isReturnNotNull)?d([e.name,t.name])?1:-1:n?-1:1}),{type:"object",detail:n}}if("array"==e.type){const n=y(e.value.type,t);return"string"==typeof n?n+"[]":{type:"object[]",detail:n.detail}}return y(e.value.type,t)}const g=[];Object.keys(o).forEach(e=>{const t=u(a(i,`./api/${e.replace(/\./g,"/")}.js`)),n=e.replace(/^([^\.]+\.)*|Controller$/g,""),r=e.replace(/\.[\s\S]*$/g,"");let s=p.find(e=>e.name==r);null==s?(s={name:r,list:[n]},p.push(s)):null==s.list.find(e=>e==n)&&s.list.push(n),g.push({name:n,date:(new Date).format("yyyy-MM-dd hh:mm:ss"),list:[]}),t.forEach(t=>{null!=o[e]&&null==o[e].find(e=>e==t.url)||g.last().list.push({name:null==t.note?"未注释":t.note.replace(/^[^\u4e00-\u9fa5]*/g,"").replace(/[\r\n][\s\S]*$/g,""),url:t.url,action:t.action,params:y(t.params,!0).detail,result:y(t.result.type,!1).detail})})}),g.forEach(e=>{const t=s.render(f,e);l.writeFile(a(r,`./api/${e.name}.html`),t,t=>{t?console.error(`${e.name}生成文档失败`,t):console.info(`${e.name}生成文档`)})}),p.sort((e,t)=>d([e.name,t.name])?1:-1),p.forEach(e=>{e.list.sort((e,t)=>d([e,t])?1:-1)}),l.writeFile(a(r,"./index.js"),`const data=${JSON.stringify(p)}`,e=>{e&&console.error("doc/index.js更新失败",e)})},33:function(e,t){e.exports=ejs}});